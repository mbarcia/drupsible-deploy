---
galaxy_info:
  author: "Mariano Barcia"
  license: 'GNU General Public License v3'
  min_ansible_version: 1.8
  platforms:
    - name: Ubuntu
      versions:
        - trusty
        - vivid
    - name: Debian
      versions:
        - wheezy
        - jessie
  categories:
    - web

dependencies:
  - role: debops.users
    sudo: yes
    users: True
    users_list:
    - name: "{{ app_env['user'] }}"
      state: 'present'

  - role: drupsible.drush
  
  - role: drupsible.newrelic
    when: provision_new_relic
    sudo: yes

  - role: debops.php5
    when: "apache2_mpm != 'prefork' and provision_new_relic and target == 'prod'"
    sudo: yes
    php5_packages:
    - newrelic-php5

  - role: debops.php5
    when: "apache2_mpm != 'prefork' and target == 'prod'"
    sudo: yes
    php5_pool_default:
      enabled: True
      name: "{{ app_name }}"
      listen: "/var/run/php5-fpm-{{ app_name }}.sock"
      user: "{{ app_env['user'] }}"
      group: "{{ app_env['group'] }}"
    php5_production: True

  - role: debops.php5
    when: "apache2_mpm != 'prefork' and target != 'prod'"
    sudo: yes
    php5_pool_default:
      enabled: True
      name: "{{ app_name }}"
      listen: "/var/run/php5-fpm-{{ app_name }}.sock"
      user: "{{ app_env['user'] }}"
      group: "{{ app_env['group'] }}"
    php5_production: False

  - role: drupsible.memcached
    when: app_env.memcached
    sudo: yes

  - role: drupsible.samba
    when: target == 'local'
    sudo: yes
