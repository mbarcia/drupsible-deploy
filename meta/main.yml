---
galaxy_info:
  author: "Mariano Barcia"
  license: 'GNU General Public License v3'
  min_ansible_version: 1.8
  platforms:
    - name: Ubuntu
      versions:
        - trusty
        - vivid
    - name: Debian
      versions:
        - wheezy
        - jessie
  categories:
    - web

dependencies:
  - role: debops.users
    sudo: yes
    users: True
    users_list:
    - name: "{{ app_env['user'] }}"
      state: 'present'

  - role: debops.php5
    sudo: yes
    when: "apache2_mpm != 'prefork'"
    php5_packages:
      - php-pear
      - php-soap
      - php5-curl
      - php5-gd
      - php5-gmp
      - php5-mcrypt
      - php5-memcache
      - php5-mysql
    php5_production: "{{ target == prod}}"
    php5_post_max_size: '32M'
    php5_pool_default:
      enabled: True
      name: "{{ app_name }}"
      listen: "/var/run/php5-fpm-{{ app_name }}.sock"
      user: "{{ app_env['user'] }}"
      group: "{{ app_env['group'] }}"

  - role: drupsible.drush

  - role: drupsible.newrelic
    when: "'newrelic-php5' in php5_packages and apache2_mpm != 'prefork'"
    sudo: yes

  - role: drupsible.memcached
    when: app_env.memcached
    sudo: yes
