---
galaxy_info:
  author: "Mariano Barcia"
  license: 'GNU General Public License v3'
  min_ansible_version: 1.8
  platforms:
    - name: Ubuntu
      versions:
        - trusty
        - vivid
    - name: Debian
      versions:
        - wheezy
        - jessie
  categories:
    - web

dependencies:
  - role: debops.users
    sudo: yes
    users: True
    users_list:
    - name: "{{ app_env['user'] }}"
      state: 'present'
    tags: config.users
    
  - role: drupsible.drush
    tags: drush
  
  - role: drupsible.newrelic
    when: provision_new_relic
    sudo: yes
    tags: newrelic

  - role: debops.php5
    when: "apache2_mpm != 'prefork' and provision_new_relic"
    sudo: yes
    php5_packages:
    - newrelic-php5
    tags: config.php5
    php5_production: {{ target == 'prod' }}

  - role: debops.php5
    when: "apache2_mpm != 'prefork'"
    sudo: yes
    php5_app_pool:
      enabled: True
      name: "{{ app_name }}"
      listen: "/var/run/php5-fpm-{{ app_name }}.sock"
      user: "{{ app_env['user'] }}"
      group: "{{ app_env['group'] }}"
      php_flag: "{{ php_flag }}"
      php_value: "{{ php_value }}"
    php5_pools: [ '{{ php5_app_pool }}' ]
    tags: config.php5

  - role: drupsible.memcached
    when: app_env.memcached
    sudo: yes
    tags: memcached

  - role: drupsible.samba
    when: target == 'local'
    sudo: yes
    tags: samba